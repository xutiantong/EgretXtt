__require=function e(t,a,n){function o(c,i){if(!a[c]){if(!t[c]){var s=c.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!i&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+c+"'")}}var u=a[c]={exports:{}};t[c][0].call(u.exports,function(e){return o(t[c][1][e]||e)},u,u.exports,e,t,a,n)}return a[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<n.length;c++)o(n[c]);return o}({RankItem:[function(e,t,a){"use strict";cc._RF.push(t,"72b64LOPUtJ5L6TZjRIkbKC","RankItem");var n=e("./RankManager");cc.Class({extends:cc.Component,properties:{avatarImgSprite:{default:null,type:cc.Sprite,serializable:!0},rankLabel:{default:null,type:cc.Label,serializable:!0},nameLabel:{default:null,type:cc.Label,serializable:!0},scoreLabel:{default:null,type:cc.Label,serializable:!0},bgImg:{default:null,type:cc.Sprite,serializable:!0},chartImg:{default:null,type:cc.Sprite,serializable:!0}},start:function(){},init:function(e,t,a){console.log("RankItem init ",e,t);var o=t.avatarUrl,r=t.nickname,c=0!=t.KVDataList.length?t.KVDataList[0].value:0;this.rankLabel.string=n.getscore(e+1),n.createImage(o,this.avatarImgSprite),this.nameLabel.string=r,this.scoreLabel.string=c.toString(),a&&n.lodeLocalSprite("ui/charts/zikuai",this.bgImg),0==e?(this.chartImg.node.active=!0,this.rankLabel.node.active=!1,this.nameLabel.node.color=cc.color(255,198,0),this.scoreLabel.node.color=cc.color(255,198,0),n.lodeLocalSprite("ui/charts/di1",this.chartImg)):1==e?(this.chartImg.node.active=!0,this.rankLabel.node.active=!1,this.nameLabel.node.color=cc.color(255,198,0),this.scoreLabel.node.color=cc.color(255,198,0),n.lodeLocalSprite("ui/charts/di2",this.chartImg)):2==e&&(this.chartImg.node.active=!0,this.rankLabel.node.active=!1,this.nameLabel.node.color=cc.color(255,198,0),this.scoreLabel.node.color=cc.color(255,198,0),n.lodeLocalSprite("ui/charts/di3",this.chartImg))}}),cc._RF.pop()},{"./RankManager":"RankManager"}],RankManager:[function(e,t,a){"use strict";cc._RF.push(t,"91422GTteJK84N3LZg1wk1x","RankManager"),t.exports={onMessage:function(e){wx.onMessage(function(t){e(t)})},getFriendData:function(e,t,a){wx.getFriendCloudStorage({keyList:e,success:function(e){console.log("%cget friend cloud storage success","color:green"),t(e)},fail:function(e){console.error("get friend cloud storage fail"),a(e)}})},getGroupCloudStorage:function(e,t,a,n){wx.getGroupCloudStorage({shareTicket:e,keyList:t,success:function(e){console.log("%cget group cloud storage success","color:green"),a(e)},fail:function(e){console.error("get group cloud storage fail"),n(e)}})},getUserCloudStorage:function(e,t,a){wx.getUserCloudStorage({keyList:e,success:function(e){console.log("%cget user cloud storage success","color:green"),t(e)},fail:function(e){console.error("get user cloud storage fail"),a(e)}})},getUserInfo:function(e,t){wx.getUserInfo({openIdList:e,success:function(e){console.log("%cget friend cloud storage success","color:green"),t(e)}})},getscore:function(e){if(e>=1e6){var t=Math.floor(e/1e6),a=e%1e3,n=(r=Math.floor(e%1e6/1e3)).toString(),o=a.toString();return r<10?n="00"+r:r<100&&(n="0"+r),a<10?o="00"+a:a<100&&(o="0"+a),t+","+n+","+o}if(e>=1e3){var r;t=Math.floor(e/1e3),n=(r=e%1e3).toString();return r<10?n="00"+r:r<100&&(n="0"+r),t+","+n}return e.toString()},createImage:function(e,t){try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.node.active=!1}},a.src=e}catch(e){cc.log(e),t.node.active=!1}},lodeLocalSprite:function(e,t){cc.loader.loadRes(e,cc.SpriteFrame,function(a,n){a?console.log("loadLocalSprite failed: ","["+e+"]"):t.spriteFrame=n})}},cc._RF.pop()},{}],RankUI:[function(e,t,a){"use strict";cc._RF.push(t,"05873H+qE5CkZdXt5xo9nY2","RankUI");var n=e("./RankManager");cc.Class({extends:cc.Component,properties:{scrollView:cc.ScrollView,contentNode:cc.Node,itemPrefab:cc.Prefab,avatarImgSprite:{default:null,type:cc.Sprite,serializable:!0},rankLabel:{default:null,type:cc.Label,serializable:!0},nameLabel:{default:null,type:cc.Label,serializable:!0},scoreLabel:{default:null,type:cc.Label,serializable:!0},rankNode:cc.Node},start:function(){var e=this;this.rankData=[],this.selfInfo=null,n.onMessage(function(t){switch(console.log("onMessage "+t),e.rankType=t.action,e.rankType){case 1:n.getFriendData([t.data.key],e.onGetFriendDataSuccess.bind(e),e.onFail.bind(e));break;case 2:n.getGroupCloudStorage(t.data.shareTicket,[t.data.key],e.onGetGroupDataSuccess.bind(e),e.onFail.bind(e))}})},onEnable:function(){console.log("onEnable"),this.node.on("initSelfData",this.initself,this)},onDisable:function(){console.log("onDisable"),this.node.off("initSelfData",this.initself,this)},draw:function(){this.contentNode.removeAllChildren(),this.rankData.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),console.log(this.rankData);for(var e=0;e<this.rankData.length;e++){var t=this.rankData[e],a=cc.instantiate(this.itemPrefab),n=!1;this.selfInfo.avatarUrl==t.avatarUrl&&(n=!0,this.initself({rank:e,data:t})),console.log(a),a.getComponent("RankItem").init(e,t,n),this.contentNode.addChild(a)}},initself:function(e){0==this.rankNode.active&&(this.rankNode.active=!0),console.log("successdata"),this.rankLabel.string=e.rank+1,this.nameLabel.string=e.data.nickname;var t=0!=e.data.KVDataList.length?e.data.KVDataList[0].value:0;this.scoreLabel.string=n.getscore(t),n.createImage(e.data.avatarUrl,this.avatarImgSprite)},onFail:function(e){console.error(e)},onGetGroupDataSuccess:function(e){console.log("onGetGroupDataSuccess"),console.log(JSON.stringify(e.data)),this.rankData=e.data,this.draw()},onGetFriendDataSuccess:function(e){console.log("onGetFriendDataSuccess"),console.log(JSON.stringify(e.data)),this.rankData=e.data,n.getUserInfo(["selfOpenId"],this.onGetUserInfoSuccess.bind(this))},onGetUserInfoSuccess:function(e){console.log("onGetUserInfoSuccess"),console.log(JSON.stringify(e.data)),this.selfInfo=e.data[0],console.log(this.selfInfo),this.draw()}}),cc._RF.pop()},{"./RankManager":"RankManager"}]},{},["RankItem","RankManager","RankUI"]);